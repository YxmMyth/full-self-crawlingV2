# Full-Self-Crawling 评估与持续改进手册

**版本**: v1.0.0  
**日期**: 2026-02-17  
**适用对象**: Agent 开发者、测试工程师、运维工程师、产品负责人  
**关联规范**: `AGENTS.md`（Runtime Contract，当前 v4.1.0）

---

## 0. 目标与原则

本手册用于在项目“基本可用”后，系统化评估 Agent 能力并驱动迭代改进，目标是避免只看流程跑通，忽略真实智能能力。

评估原则：

1. **先硬门槛，后综合评分**：先判断是否触发不可接受风险，再比较能力分。
2. **离线 + 在线双轨**：离线回放验证可复现性，在线运行验证真实环境适配。
3. **证据优先**：所有结论必须有工件、日志、事件链可审计。
4. **可回滚**：任何能力增强必须具备回退策略，不允许不可逆上线。

---

## 1. 评估范围

评估对象覆盖 7 个核心能力域：

1. 智能性（效用驱动决策）
2. 判断力（Decide2 显式评分）
3. 计划性（TaskPlan 分层规划）
4. 记忆能力（知识库写入/检索/冲突）
5. 适应性（策略画像与主动切换）
6. 执行力（L1/L2/L3 验证与 canary）
7. 学习反哺（参数更新与学习审计）

并映射到 30 项通用能力指标（见 §3）。

---

## 2. 评估阶段门（Gate）

### 2.1 Phase Gate 定义

1. **Gate P1（核心数据流）**：Decide2 显式评分可复现，分流稳定。
2. **Gate P2（修复闭环）**：L1/L2 质量验证生效，新站点 probe 生效。
3. **Gate P3（策略循环）**：效用函数、TaskPlan、学习反哺、知识库强化生效。
4. **Gate P4（生产化）**：canary 放量、并行稳定性、性能基线达标。

### 2.2 Gate 通过条件

每个 Gate 同时满足：

1. 对应必测用例通过率 >= 95%
2. 无 P0/P1 严重缺陷未关闭
3. 无违反安全基线（回滚失败、熔断绕过、不可审计运行）

---

## 3. 能力指标体系（30 项）

### A. 目标理解与约束建模（1-3）

1. 目标理解能力
2. 约束建模能力
3. 优先级能力

### B. 任务分解与规划（4-6）

4. 任务分解能力
5. 长程规划能力
6. 动态重规划能力

### C. 不确定性与假设管理（7-11）

7. 假设管理能力
8. 不确定性管理能力
9. 证据整合能力
10. 因果归因能力
11. 反事实评估能力

### D. 策略选择与泛化（12-14）

12. 策略选择能力
13. 泛化迁移能力
14. 样本效率能力

### E. 工具编排与执行鲁棒性（15-18）

15. 工具编排能力
16. 执行鲁棒性
17. 验证深度能力
18. 自我校准能力

### F. 记忆质量与协同（19-22）

19. 记忆写入质量
20. 记忆检索质量
21. 记忆冲突处理
22. 协同能力

### G. 可解释性与评测（23-30）

23. 可解释能力
24. 可观测能力
25. 评测能力
26. 抗指标作弊能力
27. 安全与治理能力
28. 成本效率能力
29. 稳定性能力
30. 产品适配能力

---

## 4. 评分模型

### 4.1 双层判定

1. **Hard Gate（必须通过）**
   - 安全熔断可触发且有效
   - 回滚路径可执行
   - 关键工件齐全且可读
   - Decide2 阈值决策可解释

2. **Capability Score（能力分）**
   - 每项指标 0-5 分
   - 每个能力域取均值
   - 总分为 7 个能力域加权和

### 4.2 权重建议

```yaml
evaluation_weights:
  intelligence: 0.18
  judgment: 0.15
  planning: 0.14
  memory: 0.13
  adaptability: 0.13
  execution: 0.15
  learning_feedback: 0.12
```

### 4.3 评级标准

1. `>= 4.2`: 可生产大规模运行
2. `3.5 - 4.2`: 可灰度运行，需跟踪改进
3. `2.8 - 3.5`: 仅限小流量/受控环境
4. `< 2.8`: 不建议上线

---

## 5. 核心评估用例（最小集）

### 5.1 决策与规划

1. 多候选修复方案输入下，验证是否选择最高 `utility_score` 方案。
2. 同一输入重复 20 次，验证 Decide2 决策一致性。
3. 关键路径步骤失败时，验证是否触发 `plan_revision` 或 fallback。

### 5.2 质量与执行

1. 构造 `title=""`、模板页、错误页样本，验证 L1/L2 拦截有效。
2. patch 级改动触发 `verify_regression`，验证 L3 业务适配分不低于阈值。
3. canary 首批失败时，验证不向全量扩散。

### 5.3 记忆与学习

1. `verify_status != pass` 的经验写入请求应被拒绝。
2. 检索结果应按“类别匹配 + 时间衰减 + effectiveness”排序。
3. 同字段冲突经验应保留归档，不得直接覆盖删除。
4. 学习后策略分使用 EMA 更新，且生成 `LearningEvent`。

### 5.4 适应性与鲁棒性

1. 新站点首次运行必须触发 probe，样本数不超上限。
2. 成功率在窗口内下降超阈值，下一批必须主动切换策略。
3. 模型降级/fallback 不得超过全局上限，超限后终止或 replan。

---

## 6. 数据采集与工件要求

每次评估 run 必须采集：

1. `summary.json`
2. `diagnosis.json`
3. `evidence.json`
4. `decision_card.json`
5. `display_manifest.json`
6. 评估附加工件：
   - `evaluation_scorecard.json`
   - `evaluation_findings.md`
   - `evaluation_actions.json`

`evaluation_scorecard.json` 最小结构：

```json
{
  "run_id": "run_xxx",
  "phase_gate": "P2",
  "hard_gate_passed": true,
  "domain_scores": {
    "intelligence": 4.1,
    "judgment": 3.9,
    "planning": 3.6,
    "memory": 3.2,
    "adaptability": 3.8,
    "execution": 4.0,
    "learning_feedback": 3.4
  },
  "overall_score": 3.74,
  "critical_findings": []
}
```

---

## 7. 评估节奏

1. **每次重要改动后**：执行一次离线回放评估。
2. **每周**：执行一次在线小流量评估，更新趋势。
3. **每个版本发布前**：执行完整 Gate 评估并冻结结果。

---

## 8. 问题分级与改进行动

### 8.1 缺陷分级

1. **P0**：安全/合规/数据灾难风险，立即停止放量
2. **P1**：关键能力失效（错误决策、回滚失效、质量门失效）
3. **P2**：能力退化（成功率下降、记忆污染、学习失效）
4. **P3**：体验或可观测性不足

### 8.2 改进行动模板

每个 finding 必须绑定：

1. 根因假设
2. 验证证据
3. 修复动作
4. 预期指标提升
5. 回归测试点
6. 截止日期与负责人

---

## 9. 退出与升级条件

### 9.1 从灰度升级到生产

满足以下全部条件：

1. 连续 3 次在线评估 `hard_gate_passed=true`
2. 总分 `overall_score >= 4.0`
3. 无未关闭 P0/P1
4. 关键成本指标未超预算（token、请求、时延）

### 9.2 回退触发条件

命中任一即回退：

1. 新版本出现 P0
2. `overall_score` 较上一版本下降 > 0.5
3. Decide2 错误分流率连续两次超阈值
4. canary 失败后仍扩散到全量

---

## 10. 常见反模式（必须避免）

1. 只看抓取量，不看语义质量和业务适配
2. 只看单次成功，不看可复现性
3. 把未验证经验写进知识库
4. 用“人工临时兜底”掩盖能力缺陷
5. 修改阈值但不记录理由与证据

---

## 11. 执行清单（Checklist）

每次评估前：

1. 锁定版本、配置、测试集
2. 确认采集工件路径可写
3. 确认回滚开关可用

每次评估后：

1. 输出 `evaluation_scorecard.json`
2. 输出 `evaluation_findings.md`
3. 输出 `evaluation_actions.json`
4. 更新下一周期改进目标

